services:
  # ════════════════════════════════════════════════════════════
  # SERVICIO WEB (API Flask)
  # ════════════════════════════════════════════════════════════
  - type: web
    name: flask-jira-api
    runtime: python
    plan: free
    pythonVersion: "3.11.0"
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120

    envVars:
      # Jira
      - key: JIRA_URL
        value: https://integratelperu.atlassian.net
      - key: JIRA_EMAIL
        value: maximiliano.merino@integratel.com.pe
      - key: JIRA_TOKEN
        sync: false

      # PostgreSQL
      - key: PG_HOST
        fromDatabase:
          name: flask-jira-db
          property: host
      - key: PG_PORT
        fromDatabase:
          name: flask-jira-db
          property: port
      - key: PG_DATABASE
        fromDatabase:
          name: flask-jira-db
          property: database
      - key: PG_USER
        fromDatabase:
          name: flask-jira-db
          property: user
      - key: PG_PASSWORD
        fromDatabase:
          name: flask-jira-db
          property: password

      # App
      - key: PG_SCHEMA
        value: proof
      - key: FLASK_ENV
        value: production

  # ════════════════════════════════════════════════════════════
  # BASE DE DATOS PostgreSQL
  # ════════════════════════════════════════════════════════════
  - type: postgres
    name: flask-jira-db
    plan: free
    databaseName: gobierno
    user: gobierno
    ipAllowList: []